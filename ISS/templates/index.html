<!DOCTYPE html>
<html>
<head>
    <title>üõ∞Ô∏è –¢—Ä–µ–∫–µ—Ä –ú–ö–°</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS: –¢–µ–ø–µ—Ä—å –±–µ–∑ integrity, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          />

    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
        #mapid { height: 600px; width: 100%; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        body { font-family: sans-serif; text-align: center; background-color: #f4f7f9; padding: 20px; }
        h1 { color: #2c3e50; margin-bottom: 20px; }
        .coords { font-size: 1.2em; margin-top: 15px; color: #34495e; }
        .data-box { background: white; padding: 10px; border-radius: 8px; display: inline-block; margin: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <h1>üõ∞Ô∏è –¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ú–ö–°</h1>

    <div id="mapid"></div>

    <div class="coords">
        <div class="data-box">–®–∏—Ä–æ—Ç–∞: <strong id="iss_lat">–û–∂–∏–¥–∞–Ω–∏–µ...</strong></div>
        <div class="data-box">–î–æ–ª–≥–æ—Ç–∞: <strong id="iss_lon">–û–∂–∏–¥–∞–Ω–∏–µ...</strong></div>
    </div>

    <!-- Leaflet JavaScript: –¢–µ–ø–µ—Ä—å –±–µ–∑ integrity, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const map = L.map('mapid').setView([0, 0], 2); // –¶–µ–Ω—Ç—Ä [0, 0], –∑—É–º 2

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–ª–æ–≤ OpenStreetMap (–ø—Ä–æ—Ç–æ–∫–æ–ª–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π URL)
        L.tileLayer('//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –ú–ö–° (–ø—Ä–æ—Ç–æ–∫–æ–ª–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π URL)
        const issIcon = L.icon({
            iconUrl: '//upload.wikimedia.org/wikipedia/commons/d/d0/ISS_logo_2016.png', 
            iconSize: [40, 40], // –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏
            iconAnchor: [20, 20], // –¢–æ—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
        });

        // –ú–∞—Ä–∫–µ—Ä –ú–ö–°. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–≥–æ –≤ [0, 0]
        const issMarker = L.marker([0, 0], { icon: issIcon }).addTo(map);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        function updateISSLocation() {
            fetch('/iss-location') // –í—ã–∑–æ–≤ Flask API
                .then(response => {
                    if (!response.ok) {
                        // –≠—Ç–∞ –≤–µ—Ç–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ Flask –≤–µ—Ä–Ω–µ—Ç 500
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const lat = parseFloat(data.latitude);
                    const lon = parseFloat(data.longitude);

                    // 1. –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
                    const newLatLng = L.latLng(lat, lon);
                    issMarker.setLatLng(newLatLng);

                    // 2. –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã, —á—Ç–æ–±—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –ú–ö–° (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    // map.panTo(newLatLng, {animate: true, duration: 1}); 

                    // 3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    document.getElementById('iss_lat').textContent = lat.toFixed(4);
                    document.getElementById('iss_lon').textContent = lon.toFixed(4);
                })
                .catch(error => {
                    // –í—ã–≤–æ–¥–∏—Ç –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ú–ö–°:', error);
                    document.getElementById('iss_lat').textContent = '–û—à–∏–±–∫–∞';
                    document.getElementById('iss_lon').textContent = '–û—à–∏–±–∫–∞';
                });
        }

        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∑–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (5000 –º—Å)
        updateISSLocation();
        setInterval(updateISSLocation, 5000);
    </script>

</body>
</html>
